(function(){"use strict";var e={7883:function(e,t,a){var s=a(5130),o=a(6768);const r={id:"app"},n={class:"app-header"},c={class:"container"},l={class:"main-nav"},i={class:"app-content"};function u(e,t,a,u,d,p){const k=(0,o.g2)("router-link"),m=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.CE)("div",r,[(0,o.Lk)("header",n,[(0,o.Lk)("div",c,[(0,o.Lk)("nav",l,[(0,o.bF)(k,{to:"/",class:"logo-link"},{default:(0,o.k6)((()=>t[0]||(t[0]=[(0,o.eW)(" 猫先生のクイズチャレンジ ")]))),_:1})])])]),(0,o.Lk)("main",i,[(0,o.bF)(m,null,{default:(0,o.k6)((({Component:e,route:t})=>[(0,o.bF)(s.eB,{name:t.meta.transition||"fade",mode:"out-in"},{default:(0,o.k6)((()=>[((0,o.uX)(),(0,o.Wv)((0,o.$y)(e)))])),_:2},1032,["name"])])),_:1})]),t[1]||(t[1]=(0,o.Lk)("footer",{class:"app-footer"},[(0,o.Lk)("div",{class:"container"},[(0,o.Lk)("p",null,"© 2025 猫先生のクイズチャレンジ")])],-1))])}var d=a(782),p={name:"App",setup(){const e=(0,d.Pj)();return(0,o.sV)((()=>{const t=["dataManagerVersion","subjectsData","topicProblems","quizResults","selectedTopics"];t.forEach((e=>{localStorage.removeItem(e),console.log(`ローカルストレージから削除: ${e}`)})),console.log("キャッシュクリア後のローカルストレージ:",Object.keys(localStorage)),e.dispatch("mistakes/loadFromLocalStorage"),e.commit("mistakes/updateClearableStatus"),console.log("キャッシュをクリアしました - 強制再読み込みを開始します"),e.dispatch("loadSubjectsData",{forceRefresh:!0}).then((()=>{console.log("科目データの再読み込みが完了しました")})).catch((e=>{console.error("科目データの再読み込み中にエラーが発生しました:",e)}))})),{}}},k=a(1241);const m=(0,k.A)(p,[["render",u]]);var v=m,g=a(973),b=a(4232);const h={class:"home"},f={class:"hero-section"},C={class:"cat-image-container"},y=["src"],_={key:0,class:"loading-container"},L={key:1,class:"error-container"},S={key:2,class:"main-menu"},E={class:"menu-buttons"},j={class:"mistakes-button-container"},w={key:0,class:"mistake-badges"},T={class:"subject-name"},F={class:"count"},q={key:0,class:"frequent-marker",title:"よく間違える問題があります"},W={key:0,class:"last-played"};function I(e,t,a,s,r,n){const c=(0,o.g2)("GrTitle"),l=(0,o.g2)("GrButton");return(0,o.uX)(),(0,o.CE)("div",h,[(0,o.Lk)("div",f,[(0,o.bF)(c,{tag:"h1",size:"xl",color:"accent2",class:"app-title"},{default:(0,o.k6)((()=>t[0]||(t[0]=[(0,o.eW)("猫先生のクイズチャレンジ")]))),_:1}),(0,o.Lk)("div",C,[(0,o.Lk)("img",{src:`${e.assetBaseUrl}assets/characters/neko_sensei/top_neko.png`,alt:"猫先生",class:"cat-image"},null,8,y)])]),s.loading?((0,o.uX)(),(0,o.CE)("div",_,t[1]||(t[1]=[(0,o.Lk)("p",null,"データを読み込み中...",-1)]))):s.error?((0,o.uX)(),(0,o.CE)("div",L,[(0,o.Lk)("p",null,"エラーが発生しました: "+(0,b.v_)(s.error),1)])):((0,o.uX)(),(0,o.CE)("div",S,[(0,o.Lk)("div",E,[(0,o.bF)(l,{variant:"accent2",size:"lg",class:"menu-button",onClick:s.navigateToSubjects},{default:(0,o.k6)((()=>t[2]||(t[2]=[(0,o.eW)(" 学習を始める ")]))),_:1},8,["onClick"]),(0,o.Lk)("div",j,[(0,o.bF)(l,{variant:"accent3",size:"lg",class:"menu-button",onClick:s.navigateToMistakes},{default:(0,o.k6)((()=>t[3]||(t[3]=[(0,o.eW)(" 間違えた問題 ")]))),_:1},8,["onClick"]),s.hasMistakes?((0,o.uX)(),(0,o.CE)("div",w,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.subjectsWithMistakes,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e,class:(0,b.C4)(["mistake-badge",{"has-frequent":s.frequentMistakesBySubject[e]}])},[(0,o.Lk)("span",T,(0,b.v_)("science"===e?"理科":"社会"),1),(0,o.Lk)("span",F,(0,b.v_)(s.mistakesBySubject[e]),1),s.frequentMistakesBySubject[e]?((0,o.uX)(),(0,o.CE)("span",q,"★")):(0,o.Q3)("",!0)],2)))),128))])):(0,o.Q3)("",!0)])]),s.userData.lastPlayed?((0,o.uX)(),(0,o.CE)("div",W,[(0,o.Lk)("p",null,"最終プレイ日時: "+(0,b.v_)(s.formatDate(s.userData.lastPlayed)),1)])):(0,o.Q3)("",!0)]))])}a(4114);var M=a(144);function D(e,t,a,s,r,n){return(0,o.uX)(),(0,o.Wv)((0,o.$y)(a.tag),{class:(0,b.C4)(["gr-title",n.sizeClass,n.colorClass])},{default:(0,o.k6)((()=>[(0,o.RG)(e.$slots,"default",{},void 0,!0)])),_:3},8,["class"])}var R={name:"GrTitle",props:{tag:{type:String,default:"h2",validator:e=>["h1","h2","h3","h4","h5","h6","div","span"].includes(e)},size:{type:String,default:"md",validator:e=>["sm","md","lg","xl"].includes(e)},color:{type:String,default:"primary",validator:e=>["primary","accent1","accent2","accent3","accent4"].includes(e)}},computed:{sizeClass(){return`title-${this.size}`},colorClass(){return`title-${this.color}`}}};const A=(0,k.A)(R,[["render",D],["__scopeId","data-v-4c32d44f"]]);var $=A;const B=["disabled"];function G(e,t,a,s,r,n){return(0,o.uX)(),(0,o.CE)("button",{class:(0,b.C4)(["gr-button",n.variantClass,n.sizeClass,{"full-width":a.fullWidth}]),disabled:a.disabled,onClick:t[0]||(t[0]=t=>e.$emit("click",t))},[(0,o.RG)(e.$slots,"default",{},void 0,!0)],10,B)}var O={name:"GrButton",props:{variant:{type:String,default:"primary",validator:e=>["primary","accent1","accent2","accent3","accent4"].includes(e)},size:{type:String,default:"md",validator:e=>["sm","md","lg"].includes(e)},disabled:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1}},computed:{variantClass(){return`btn-${this.variant}`},sizeClass(){return`btn-${this.size}`}}};const x=(0,k.A)(O,[["render",G],["__scopeId","data-v-ff760462"]]);var z=x,X={name:"HomeView",components:{GrTitle:$,GrButton:z},setup(){const e=(0,d.Pj)(),t=(0,g.rd)(),a=(0,M.KR)({currentRank:"初級",score:0,lastPlayed:null}),s=(0,o.EW)((()=>e.getters.getSubjects)),r=(0,o.EW)((()=>e.getters.isLoading)),n=(0,o.EW)((()=>e.getters.getError)),c=(0,o.EW)((()=>e.getters["mistakes/mistakesBySubject"])),l=(0,o.EW)((()=>e.getters["mistakes/frequentMistakesBySubject"])),i=(0,o.EW)((()=>["science","social"].filter((e=>c.value[e])))),u=(0,o.EW)((()=>Object.keys(c.value).length>0));(0,o.sV)((async()=>{await e.dispatch("loadSubjectsData"),e.dispatch("mistakes/loadFromLocalStorage"),e.commit("mistakes/updateClearableStatus"),a.value={currentRank:"ねこ見習い",score:120,lastPlayed:(new Date).toISOString()}}));const p=e=>{const t=new Date(e);return t.toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},k=()=>{t.push({name:"subjects"})},m=()=>{t.push({name:"mistakes"})};return{subjects:s,loading:r,error:n,userData:a,formatDate:p,mistakesBySubject:c,frequentMistakesBySubject:l,hasMistakes:u,subjectsWithMistakes:i,navigateToSubjects:k,navigateToMistakes:m}}};const P=(0,k.A)(X,[["render",I],["__scopeId","data-v-68c28200"]]);var U=P;const Q={class:"subject-select"},K={key:0,class:"loading-container"},N={key:1,class:"error-container"},V={key:2,class:"subjects-grid"},J=["src","alt"],H={key:1},Y={class:"subject-name"},Z={class:"subject-topics"},ee={class:"navigation-buttons"};function te(e,t,a,s,r,n){const c=(0,o.g2)("GrTitle"),l=(0,o.g2)("GrCard"),i=(0,o.g2)("GrButton");return(0,o.uX)(),(0,o.CE)("div",Q,[(0,o.bF)(c,{tag:"h1",size:"lg",color:"primary",class:"page-title"},{default:(0,o.k6)((()=>t[0]||(t[0]=[(0,o.eW)("教科を選んでください")]))),_:1}),s.loading?((0,o.uX)(),(0,o.CE)("div",K,t[1]||(t[1]=[(0,o.Lk)("p",null,"データを読み込み中...",-1)]))):s.error?((0,o.uX)(),(0,o.CE)("div",N,[(0,o.Lk)("p",null,"エラーが発生しました: "+(0,b.v_)(s.error),1)])):((0,o.uX)(),(0,o.CE)("div",V,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.subjects,(e=>((0,o.uX)(),(0,o.Wv)(l,{key:e.code,class:"subject-card",border:e.code,elevation:"md",onClick:t=>s.navigateToTopics(e.code)},{default:(0,o.k6)((()=>[(0,o.Lk)("div",{class:"subject-content",style:(0,b.Tr)({backgroundColor:e.color+"33"})},[(0,o.Lk)("div",{class:"subject-icon",style:(0,b.Tr)({backgroundColor:e.color})},[e.icon?((0,o.uX)(),(0,o.CE)("img",{key:0,src:`${s.assetBaseUrl}${e.icon}`,alt:e.name},null,8,J)):((0,o.uX)(),(0,o.CE)("span",H,(0,b.v_)(e.name.charAt(0)),1))],4),(0,o.Lk)("h3",Y,(0,b.v_)(e.name),1),(0,o.Lk)("p",Z,(0,b.v_)(e.topics.length)+"個の単元",1)],4)])),_:2},1032,["border","onClick"])))),128))])),(0,o.Lk)("div",ee,[(0,o.bF)(i,{variant:"primary",size:"md",onClick:s.navigateToHome},{default:(0,o.k6)((()=>t[2]||(t[2]=[(0,o.eW)(" ホームに戻る ")]))),_:1},8,["onClick"])])])}function ae(e,t,a,s,r,n){return(0,o.uX)(),(0,o.CE)("div",{class:(0,b.C4)(["gr-card",n.elevationClass,n.borderClass])},[(0,o.RG)(e.$slots,"default",{},void 0,!0)],2)}var se={name:"GrCard",props:{elevation:{type:String,default:"md",validator:e=>["none","sm","md","lg"].includes(e)},border:{type:String,default:"primary",validator:e=>["none","primary","accent1","accent2","accent3","accent4","social","science"].includes(e)}},computed:{elevationClass(){return`elevation-${this.elevation}`},borderClass(){return`border-${this.border}`}}};const oe=(0,k.A)(se,[["render",ae],["__scopeId","data-v-597a96e0"]]);var re=oe;const ne=!0,ce=ne?"/cat-teacher-quiz/":"/";var le={name:"SubjectSelectView",components:{GrTitle:$,GrCard:re,GrButton:z},setup(){const e=(0,d.Pj)(),t=(0,g.rd)(),a=(0,o.EW)((()=>e.getters.getSubjects)),s=(0,o.EW)((()=>e.getters.isLoading)),r=(0,o.EW)((()=>e.getters.getError));(0,o.sV)((async()=>{a.value.length||await e.dispatch("loadSubjectsData")}));const n=e=>{t.push({name:"topics",params:{subjectCode:e}})},c=()=>{t.push({name:"home"})};return{subjects:a,loading:s,error:r,navigateToTopics:n,navigateToHome:c,assetBaseUrl:ce}}};const ie=(0,k.A)(le,[["render",te],["__scopeId","data-v-2c3b28eb"]]);var ue=ie;const de={class:"topic-select"},pe={class:"header-section"},ke={key:0,class:"loading-container"},me={key:1,class:"error-container"},ve={key:2,class:"error-container"},ge={key:3,class:"topics-grid"},be={class:"topic-content"},he={class:"topic-header"},fe=["src","alt"],Ce={key:1},ye={class:"topic-name"},_e={class:"topic-details"},Le={class:"detail-item"},Se={class:"detail-item"},Ee={class:"detail-item"},je={class:"navigation-buttons"};function we(e,t,a,s,r,n){const c=(0,o.g2)("GrTitle"),l=(0,o.g2)("GrBubble"),i=(0,o.g2)("GrButton"),u=(0,o.g2)("GrHighlight"),d=(0,o.g2)("GrCard");return(0,o.uX)(),(0,o.CE)("div",de,[(0,o.Lk)("div",pe,[(0,o.bF)(c,{tag:"h1",size:"lg",color:"primary",class:"page-title"},{default:(0,o.k6)((()=>[(0,o.eW)((0,b.v_)(s.currentSubject?s.currentSubject.name:"単元を選んでください"),1)])),_:1}),(0,o.bF)(l,{direction:"right",color:"accent2",class:"instruction-bubble"},{default:(0,o.k6)((()=>t[0]||(t[0]=[(0,o.eW)(" 学習したい単元を選んでください ")]))),_:1})]),s.loading?((0,o.uX)(),(0,o.CE)("div",ke,t[1]||(t[1]=[(0,o.Lk)("p",null,"データを読み込み中...",-1)]))):s.error?((0,o.uX)(),(0,o.CE)("div",me,[(0,o.Lk)("p",null,"エラーが発生しました: "+(0,b.v_)(s.error),1)])):s.currentSubject?((0,o.uX)(),(0,o.CE)("div",ge,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.currentSubject.topics,(e=>((0,o.uX)(),(0,o.Wv)(d,{key:e.code,class:"topic-card",border:e.code,elevation:"md",onClick:t=>s.navigateToQuiz(s.currentSubject.code,e.code)},{default:(0,o.k6)((()=>[(0,o.Lk)("div",be,[(0,o.Lk)("div",he,[(0,o.Lk)("div",{class:"topic-icon",style:(0,b.Tr)({backgroundColor:s.currentSubject.color})},[e.icon?((0,o.uX)(),(0,o.CE)("img",{key:0,src:`${s.assetBaseUrl}${e.icon}`,alt:e.name},null,8,fe)):((0,o.uX)(),(0,o.CE)("span",Ce,(0,b.v_)(e.name.charAt(0)),1))],4),(0,o.Lk)("h3",ye,(0,b.v_)(e.name),1)]),(0,o.Lk)("div",_e,[(0,o.Lk)("div",Le,[t[4]||(t[4]=(0,o.Lk)("span",{class:"detail-label"},"問題数:",-1)),(0,o.bF)(u,{color:"yellow",inline:!0},{default:(0,o.k6)((()=>[(0,o.eW)((0,b.v_)(e.questionCount)+"問",1)])),_:2},1024)]),(0,o.Lk)("div",Se,[t[5]||(t[5]=(0,o.Lk)("span",{class:"detail-label"},"難易度:",-1)),(0,o.bF)(u,{color:"accent3",inline:!0},{default:(0,o.k6)((()=>[(0,o.eW)((0,b.v_)(e.difficulty),1)])),_:2},1024)]),(0,o.Lk)("div",Ee,[t[6]||(t[6]=(0,o.Lk)("span",{class:"detail-label"},"対象年齢:",-1)),(0,o.bF)(u,{color:"accent2",inline:!0},{default:(0,o.k6)((()=>[(0,o.eW)((0,b.v_)(e.targetAge),1)])),_:2},1024)])])])])),_:2},1032,["border","onClick"])))),128))])):((0,o.uX)(),(0,o.CE)("div",ve,[t[3]||(t[3]=(0,o.Lk)("p",null,"科目が見つかりません。科目選択画面に戻ってください。",-1)),(0,o.bF)(i,{variant:"primary",size:"md",onClick:s.navigateToSubjects,class:"mt-4"},{default:(0,o.k6)((()=>t[2]||(t[2]=[(0,o.eW)(" 科目選択に戻る ")]))),_:1},8,["onClick"])])),(0,o.Lk)("div",je,[(0,o.bF)(i,{variant:"primary",size:"md",onClick:s.navigateToSubjects},{default:(0,o.k6)((()=>t[7]||(t[7]=[(0,o.eW)(" 科目選択に戻る ")]))),_:1},8,["onClick"])])])}a(8111),a(116);function Te(e,t,a,s,r,n){return(0,o.uX)(),(0,o.CE)("div",{class:(0,b.C4)(["gr-bubble",`bubble-${a.direction}`,n.colorClass])},[(0,o.RG)(e.$slots,"default",{},void 0,!0)],2)}var Fe={name:"GrBubble",props:{direction:{type:String,default:"bottom",validator:e=>["top","right","bottom","left"].includes(e)},color:{type:String,default:"primary",validator:e=>["primary","accent1","accent2","accent3","accent4","white"].includes(e)}},computed:{colorClass(){return`bubble-${this.color}`}}};const qe=(0,k.A)(Fe,[["render",Te],["__scopeId","data-v-28f63b2b"]]);var We=qe;function Ie(e,t,a,s,r,n){return(0,o.uX)(),(0,o.CE)("span",{class:(0,b.C4)(["gr-highlight",n.colorClass,{inline:a.inline}])},[(0,o.RG)(e.$slots,"default",{},void 0,!0)],2)}var Me={name:"GrHighlight",props:{color:{type:String,default:"yellow",validator:e=>["yellow","orange","red"].includes(e)},inline:{type:Boolean,default:!0}},computed:{colorClass(){return`highlight-${this.color}`}}};const De=(0,k.A)(Me,[["render",Ie],["__scopeId","data-v-31b1ff5c"]]);var Re=De,Ae={name:"TopicSelectView",components:{GrTitle:$,GrCard:re,GrButton:z,GrBubble:We,GrHighlight:Re},setup(){const e=(0,d.Pj)(),t=(0,g.rd)(),a=(0,g.lq)(),s=a.params.subjectCode,r=(0,o.EW)((()=>e.getters.getSubjects)),n=(0,o.EW)((()=>r.value.find((e=>e.code===s)))),c=(0,o.EW)((()=>e.getters.isLoading)),l=(0,o.EW)((()=>e.getters.getError));(0,o.sV)((async()=>{r.value.length||await e.dispatch("loadSubjectsData")}));const i=(e,a)=>{t.push({name:"quiz",params:{subjectCode:e,topicCode:a}})},u=()=>{t.push({name:"subjects"})};return{subjects:r,currentSubject:n,loading:c,error:l,navigateToQuiz:i,navigateToSubjects:u,assetBaseUrl:ce}}};const $e=(0,k.A)(Ae,[["render",we],["__scopeId","data-v-b437ba1e"]]);var Be=$e;const Ge={class:"quiz-view"},Oe={class:"quiz-header"},xe={class:"quiz-info"},ze={class:"quiz-progress"},Xe={class:"progress-text"},Pe={class:"progress-bar"},Ue={key:0,class:"loading-container"},Qe={key:1,class:"error-container"},Ke={key:2,class:"error-container"},Ne={key:3,class:"quiz-content"},Ve={class:"question-section"},Je={class:"question-text"},He={class:"choices-section"},Ye={class:"choices-grid"},Ze={key:0,class:"feedback-section"},et={class:"feedback-content"},tt={class:"explanation"},at={class:"navigation-buttons"},st={class:"character-section"};function ot(e,t,a,s,r,n){const c=(0,o.g2)("GrTitle"),l=(0,o.g2)("GrButton"),i=(0,o.g2)("GrCard"),u=(0,o.g2)("character-display");return(0,o.uX)(),(0,o.CE)("div",Ge,[(0,o.Lk)("div",Oe,[(0,o.Lk)("div",xe,[(0,o.bF)(c,{tag:"h2",size:"md",color:"primary"},{default:(0,o.k6)((()=>[(0,o.eW)((0,b.v_)(s.currentSubject?s.currentSubject.name:"")+" - "+(0,b.v_)(s.currentTopic?s.currentTopic.name:""),1)])),_:1}),(0,o.Lk)("div",ze,[(0,o.Lk)("div",Xe,"問題 "+(0,b.v_)(s.currentQuestionIndex+1)+" / "+(0,b.v_)(s.questions.length),1),(0,o.Lk)("div",Pe,[(0,o.Lk)("div",{class:"progress-fill",style:(0,b.Tr)({width:`${s.progressPercentage}%`})},null,4)])])])]),s.loading?((0,o.uX)(),(0,o.CE)("div",Ue,t[0]||(t[0]=[(0,o.Lk)("p",null,"データを読み込み中...",-1)]))):s.error?((0,o.uX)(),(0,o.CE)("div",Qe,[(0,o.Lk)("p",null,"エラーが発生しました: "+(0,b.v_)(s.error),1)])):s.currentQuestion?((0,o.uX)(),(0,o.CE)("div",Ne,[(0,o.Lk)("div",Ve,[(0,o.bF)(i,{class:"question-card",elevation:"md",border:"primary"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{tag:"h3",size:"md",color:"primary",class:"question-title"},{default:(0,o.k6)((()=>t[3]||(t[3]=[(0,o.eW)("問題")]))),_:1}),(0,o.Lk)("p",Je,(0,b.v_)(s.currentQuestion.question),1)])),_:1})]),(0,o.Lk)("div",He,[(0,o.Lk)("div",Ye,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.currentQuestion.options,((e,t)=>((0,o.uX)(),(0,o.Wv)(l,{key:t,variant:s.getChoiceVariant(t),size:"lg",class:"choice-button",disabled:s.answerSubmitted,onClick:e=>s.selectAnswer(t)},{default:(0,o.k6)((()=>[(0,o.eW)((0,b.v_)(e),1)])),_:2},1032,["variant","disabled","onClick"])))),128))])]),s.answerSubmitted?((0,o.uX)(),(0,o.CE)("div",Ze,[(0,o.bF)(i,{class:"feedback-card",elevation:s.feedbackCardElevation,border:s.feedbackCardBorder},{default:(0,o.k6)((()=>[(0,o.Lk)("div",et,[(0,o.bF)(c,{tag:"h3",size:"md",color:s.isCorrect?"accent2":"accent4",class:"feedback-title"},{default:(0,o.k6)((()=>[(0,o.eW)((0,b.v_)(s.isCorrect?"正解！":"不正解..."),1)])),_:1},8,["color"]),(0,o.Lk)("p",tt,(0,b.v_)(s.currentQuestion.explanation),1)])])),_:1},8,["elevation","border"]),(0,o.Lk)("div",at,[(0,o.bF)(l,{variant:"accent2",size:"lg",onClick:s.nextQuestion,disabled:!s.answerSubmitted},{default:(0,o.k6)((()=>[(0,o.eW)((0,b.v_)(s.isLastQuestion?"結果を見る":"次の問題へ"),1)])),_:1},8,["onClick","disabled"])])])):(0,o.Q3)("",!0)])):((0,o.uX)(),(0,o.CE)("div",Ke,[t[2]||(t[2]=(0,o.Lk)("p",null,"問題が見つかりません。別の単元を選んでください。",-1)),(0,o.bF)(l,{variant:"primary",size:"md",onClick:s.navigateToTopics,class:"mt-4"},{default:(0,o.k6)((()=>t[1]||(t[1]=[(0,o.eW)(" 単元選択に戻る ")]))),_:1},8,["onClick"])])),(0,o.Lk)("div",st,[(0,o.bF)(u,{character:s.getCharacterType(),state:s.getCharacterState(),message:s.characterMessage},null,8,["character","state","message"])])])}const rt={class:"character-display"},nt={class:"character-image"},ct=["src","alt"];function lt(e,t,a,s,r,n){const c=(0,o.g2)("GrBubble");return(0,o.uX)(),(0,o.CE)("div",rt,[a.message?((0,o.uX)(),(0,o.Wv)(c,{key:0,direction:"left",color:s.bubbleColor,class:"character-bubble"},{default:(0,o.k6)((()=>[(0,o.eW)((0,b.v_)(a.message),1)])),_:1},8,["color"])):(0,o.Q3)("",!0),(0,o.Lk)("div",nt,[s.imageUrl?((0,o.uX)(),(0,o.CE)("img",{key:0,src:s.imageUrl,alt:s.characterName,class:"character-img"},null,8,ct)):((0,o.uX)(),(0,o.CE)("div",{key:1,class:"character-placeholder",style:(0,b.Tr)({backgroundColor:s.characterColor})},(0,b.v_)(s.characterName),5))])])}var it={name:"CharacterDisplay",components:{GrBubble:We},props:{character:{type:String,default:"neko_sensei",validator:e=>["neko_sensei","usagi_coach","fukurou_professor","wanwan_doctor"].includes(e)},state:{type:String,default:"normal",validator:e=>["normal","happy","teasing"].includes(e)},message:{type:String,default:""}},setup(e){const t=(0,o.EW)((()=>{const t={neko_sensei:"ねこ先生",usagi_coach:"うさぎコーチ",fukurou_professor:"ふくろう教授",wanwan_doctor:"わんわん博士"};return t[e.character]||"不明なキャラクター"})),a=(0,o.EW)((()=>{const t={neko_sensei:"#FFD166",usagi_coach:"#06D6A0",fukurou_professor:"#118AB2",wanwan_doctor:"#EF476F"};return t[e.character]||"#CCCCCC"})),s=(0,o.EW)((()=>{const t={normal:"primary",happy:"accent2",teasing:"accent4"};return t[e.state]||"primary"})),r=(0,o.EW)((()=>`${ce}assets/characters/${e.character}/${e.character}_${e.state}.png`));return{characterName:t,characterColor:a,bubbleColor:s,imageUrl:r}}};const ut=(0,k.A)(it,[["render",lt],["__scopeId","data-v-6a84e945"]]);var dt=ut,pt={name:"QuizView",components:{GrTitle:$,GrCard:re,GrButton:z,CharacterDisplay:dt},setup(){const e=(0,d.Pj)(),t=(0,g.rd)(),a=(0,g.lq)(),s=a.params.subjectCode,r=a.params.topicCode,n=(0,M.KR)([]),c=(0,M.KR)(0),l=(0,M.KR)(null),i=(0,M.KR)(!1),u=(0,M.KR)(!1),p=(0,M.KR)("問題を解いてみよう！"),k=(0,M.KR)("neko_sensei"),m=(0,M.KR)("normal"),v=(0,o.EW)((()=>e.getters.getSubjects)),b=(0,o.EW)((()=>v.value.find((e=>e.code===s)))),h=(0,o.EW)((()=>b.value?b.value.topics.find((e=>e.code===r)):null)),f=(0,o.EW)((()=>e.getters.isLoading)),C=(0,o.EW)((()=>e.getters.getError)),y=(0,o.EW)((()=>0===n.value.length?null:n.value[c.value])),_=(0,o.EW)((()=>0===n.value.length?0:c.value/n.value.length*100)),L=(0,o.EW)((()=>c.value===n.value.length-1)),S=(0,o.EW)((()=>u.value?"lg":"sm")),E=(0,o.EW)((()=>u.value?"accent2":"accent4")),j=(0,o.EW)((()=>i.value?u.value?"accent2":"accent4":"primary")),w=(0,M.KR)(a.query.mode||"normal"),T=(0,M.KR)(a.query.questionId||null),F=(0,M.KR)([]),q=(0,M.KR)("true"===a.query.frequentOnly);if("retryMultiple"===w.value&&a.query.questionIds)try{F.value=JSON.parse(a.query.questionIds),console.log("複数問題再挑戦モード:",{"問題数":F.value.length,"よく間違える問題モード":q.value})}catch(x){console.error("問題 ID リストの解析エラー:",x)}(0,o.sV)((async()=>{try{const t={correctCount:0,totalQuestions:0,incorrectIds:[],subjectCode:a.params.subjectCode,topicCode:a.params.topicCode};console.log("全ローカルストレージキー:",Object.keys(localStorage)),localStorage.setItem("quizResults",JSON.stringify(t)),console.log("クイズ結果を初期化しました:",t),console.log("クイズパラメータ:",{"科目コード":s,"トピックコード":r,"モード":w.value}),"retry"===w.value?p.value="間違えた問題に再挑戦してみよう！":"retryMultiple"===w.value&&(q.value?p.value="よく間違える問題に挑戦してみよう！克服できるかにゃ？":p.value="間違えた問題に挑戦してみよう！今度はできるかにゃ？"),await e.dispatch("loadSubjectsData",{forceRefresh:!0}),console.log("科目データを強制的に再読み込みしました"),await e.dispatch("loadProblems",{subjectCode:s,topicCode:r,forceRefresh:!0});const o=e.getters.getProblems;if(console.log("取得した問題データ:",o.length,"個"),!o||0===o.length)throw new Error("問題データが見つかりませんでした。");if(n.value=o,"retry"===w.value&&T.value){const e=n.value.find((e=>e.id===T.value));e?(n.value=[e],console.log("再挑戦モード: 問題 ID",T.value)):console.error("指定された問題 ID が見つかりません:",T.value)}else if("retryMultiple"===w.value&&F.value.length>0){const e=[];for(const t of F.value){const a=n.value.find((e=>e.id===t));a&&e.push(a)}e.length>0?(n.value=e,n.value=W([...n.value]),console.log("複数問題再挑戦モード: 読み込み完了",{"読み込み成功数":e.length,"対象問題数":F.value.length})):console.error("指定された問題が見つかりません")}else n.value=W([...n.value])}catch(x){console.error("問題データの読み込み中にエラーが発生しました:",x),e.commit("SET_ERROR",x.message)}}));const W=e=>{for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e},I=t=>{l.value=t,i.value=!0,u.value=t===y.value.correctAnswer;const s=JSON.parse(localStorage.getItem("quizResults"));if(u.value)s.correctCount+=1;else{const t=y.value.id;s.incorrectIds.includes(t)||(s.incorrectIds.push(t),console.log("間違えた問題データ:",{id:y.value.id,question:y.value.question,explanation:y.value.explanation}),e.commit("addMistake",{questionId:y.value.id,subject:a.params.subjectCode,topic:a.params.topicCode,question:y.value.question,options:y.value.options,correctAnswer:y.value.correctAnswer,explanation:y.value.explanation}))}console.log("回答後の状態:",{"問題番号":c.value+1,"正解":u.value,"正答数":s.correctCount,"不正解問題数":s.incorrectIds.length}),s.subjectCode=a.params.subjectCode,s.topicCode=a.params.topicCode,console.log("クイズ結果更新:",s),localStorage.setItem("quizResults",JSON.stringify(s)),u.value?(p.value=A(),m.value="happy"):(p.value=$(),m.value="teasing")},D=()=>{if(!1!==i.value)if(L.value){const e=JSON.parse(localStorage.getItem("quizResults"));e.totalQuestions=n.value.length;const o=e.incorrectIds.length;e.correctCount=e.totalQuestions-o,e.subjectCode=a.params.subjectCode,e.topicCode=a.params.topicCode,console.log("クイズ結果を保存して結果画面へ遷移"),console.log("クイズ結果最終:",{"総問題数":e.totalQuestions,"正答数":e.correctCount,"不正解数":o,"正答率":Math.round(e.correctCount/e.totalQuestions*100)+"%","間違えた問題数":e.incorrectIds.length,"間違えた問題IDs":e.incorrectIds}),localStorage.setItem("quizResults",JSON.stringify(e)),t.push({name:"result",params:{subjectCode:s,topicCode:r}})}else{if(console.log("次の問題へ移動: ",c.value+1),!i.value)return;i.value=!1,l.value=null,c.value<n.value.length-1&&(c.value+=1),p.value="次の問題です！がんばって！",m.value="normal"}else console.log("まだ回答が提出されていないため、nextQuestionをスキップします")},R=e=>i.value?e===y.value.correctAnswer?"accent2":e===l.value?"accent4":"primary":"primary",A=()=>{const e=["すごい！正解だにゃ！","さすがだにゃ！","その調子だにゃ！","完璧だにゃ！","君は天才かもしれないにゃ！"];return e[Math.floor(Math.random()*e.length)]},$=()=>{const e=["ざんねん！もう少しだったにゃ...","にゃんと！間違えたにゃ...","次は頑張るにゃ！","ドンマイにゃ～","ねこだって間違えることはあるにゃ"];return e[Math.floor(Math.random()*e.length)]},B=()=>{t.push({name:"topics",params:{subjectCode:s}})},G=()=>{if(!y.value)return"neko_sensei";const e=y.value.difficulty;return 3===e?"wanwan_doctor":2===e?"fukurou_professor":1.5===e?"usagi_coach":"neko_sensei"},O=()=>i.value?u.value?"happy":"teasing":"normal";return{subjects:v,currentSubject:b,currentTopic:h,loading:f,error:C,questions:n,currentQuestionIndex:c,currentQuestion:y,selectedAnswer:l,answerSubmitted:i,isCorrect:u,progressPercentage:_,isLastQuestion:L,characterMessage:p,characterType:k,characterState:m,feedbackCardElevation:S,feedbackCardBorder:E,characterBubbleColor:j,quizMode:w,retryQuestionId:T,retryQuestionIds:F,isFrequentMistakesMode:q,selectAnswer:I,nextQuestion:D,getChoiceVariant:R,navigateToTopics:B,getCharacterType:G,getCharacterState:O}}};const kt=(0,k.A)(pt,[["render",ot],["__scopeId","data-v-423a8ff2"]]);var mt=kt;const vt={class:"result-view"},gt={class:"result-header"},bt={class:"result-content"},ht={class:"score-display"},ft={class:"percentage"},Ct={key:0,class:"mistake-info"},yt={key:0,class:"frequent-mistake-warning"},_t={class:"character-feedback"},Lt={class:"action-buttons"};function St(e,t,a,s,r,n){const c=(0,o.g2)("GrTitle"),l=(0,o.g2)("GrButton"),i=(0,o.g2)("GrCard"),u=(0,o.g2)("CharacterDisplay");return(0,o.uX)(),(0,o.CE)("div",vt,[(0,o.Lk)("div",gt,[(0,o.bF)(c,{tag:"h1",size:"lg",color:"primary"},{default:(0,o.k6)((()=>t[0]||(t[0]=[(0,o.eW)("結果発表")]))),_:1})]),(0,o.Lk)("div",bt,[(0,o.Lk)("div",ht,[(0,o.bF)(c,{tag:"h2",size:"md",color:"primary"},{default:(0,o.k6)((()=>[(0,o.eW)(" 正答数: "+(0,b.v_)(s.correctCount)+" / "+(0,b.v_)(s.totalQuestions),1)])),_:1}),(0,o.Lk)("p",ft,"正答率: "+(0,b.v_)(s.percentageCorrect)+"%",1),s.incorrectIds.length>0?((0,o.uX)(),(0,o.CE)("div",Ct,[(0,o.bF)(i,{elevation:"sm",border:"warning",class:"mistake-card"},{default:(0,o.k6)((()=>[(0,o.Lk)("p",null,"あなたは "+(0,b.v_)(s.totalQuestions-s.correctCount)+" 問の問題に間違えました。",1),s.hasFrequentMistakes?((0,o.uX)(),(0,o.CE)("p",yt,t[1]||(t[1]=[(0,o.Lk)("span",{class:"warning-icon"},"⚠️",-1),(0,o.eW)(" よく間違える問題があります！ ")]))):(0,o.Q3)("",!0),(0,o.Lk)("p",null,[(0,o.bF)(l,{variant:"accent3",size:"sm",onClick:s.navigateToMistakes},{default:(0,o.k6)((()=>t[2]||(t[2]=[(0,o.eW)("間違えた問題を確認")]))),_:1},8,["onClick"])])])),_:1})])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",_t,[(0,o.bF)(u,{emotion:s.getFeedbackEmotion(),speechText:s.getFeedbackMessage()},null,8,["emotion","speechText"])]),(0,o.Lk)("div",Lt,[(0,o.bF)(l,{variant:"secondary",size:"lg",onClick:s.tryAgain},{default:(0,o.k6)((()=>t[3]||(t[3]=[(0,o.eW)(" もう一度チャレンジ ")]))),_:1},8,["onClick"]),(0,o.bF)(l,{variant:"primary",size:"lg",onClick:s.goToHome},{default:(0,o.k6)((()=>t[4]||(t[4]=[(0,o.eW)(" ホームに戻る ")]))),_:1},8,["onClick"])])])])}a(7588);var Et={name:"ResultView",components:{GrTitle:$,GrButton:z,GrCard:re,CharacterDisplay:dt},setup(){const e=(0,g.rd)(),t=(0,g.lq)(),a=(0,d.Pj)(),s=(0,M.KR)(0),r=(0,M.KR)(0),n=(0,M.KR)([]),c=(0,M.KR)(""),l=(0,M.KR)(""),i=(0,M.KR)(!1),u=(0,o.EW)((()=>r.value?Math.round(s.value/r.value*100):0));(0,o.sV)((async()=>{const e=JSON.parse(localStorage.getItem("quizResults"))||{};s.value=e.correctCount||0,r.value=e.totalQuestions||1,n.value=e.incorrectIds||[],c.value=e.subjectCode||"",l.value=e.topicCode||"",n.value.length>0&&await p()}));const p=async()=>{if(c.value&&l.value){await a.dispatch("loadProblems",{subjectCode:c.value,topicCode:l.value});const e=a.getters.getProblems,t=a.getters.getMetadata;n.value.forEach((s=>{const o=e.find((e=>e.id===s));o&&a.commit("mistakes/addMistake",{questionId:o.id,subject:t.subject,topic:t.topic,question:o.question,choices:o.choices,correctAnswer:o.correctAnswer})})),a.dispatch("mistakes/saveToLocalStorage");const s=a.getters["mistakes/frequentMistakesBySubject"];i.value=s[t.subject]>0}},k=()=>{const e=u.value;return 100===e?"excited":e>=80?"happy":e>=60?"normal":e>=40?"confused":"sad"},m=()=>{const e=u.value;return 100===e?"完璧だニャ！さすがですニャ！":e>=80?"とても良くできましたニャ！この調子で頑張りましょうニャ！":e>=60?"まあまあできていますニャ。もう少し頑張りましょうニャ！":e>=40?"もう少し勉強が必要ですニャ。間違えた問題を復習しましょうニャ。":"もっと真面目に勉強しないとダメニャ！逆にランクが下がるよニャ！"},v=()=>{e.push({name:"mistakes"})},b=()=>{e.push({name:"quiz",params:t.params})},h=()=>{e.push({name:"home"})};return{correctCount:s,totalQuestions:r,percentageCorrect:u,incorrectIds:n,hasFrequentMistakes:i,getFeedbackEmotion:k,getFeedbackMessage:m,navigateToMistakes:v,tryAgain:b,goToHome:h}}};const jt=(0,k.A)(Et,[["render",St],["__scopeId","data-v-4fb23810"]]);var wt=jt;const Tt={class:"component-preview"},Ft={class:"preview-section"},qt={class:"preview-container"},Wt={class:"preview-section"},It={class:"preview-container cards-grid"},Mt={class:"preview-section"},Dt={class:"preview-container buttons-container"},Rt={class:"button-row"},At={class:"button-row"},$t={class:"button-row"},Bt={class:"preview-section"},Gt={class:"preview-container bubbles-container"},Ot={class:"bubble-row"},xt={class:"bubble-row"},zt={class:"bubble-row"},Xt={class:"preview-section"},Pt={class:"preview-container"},Ut={class:"preview-section"},Qt={class:"preview-container"},Kt={class:"mt-4"},Nt={class:"mt-4 text-center"};function Vt(e,t,a,s,r,n){const c=(0,o.g2)("GrTitle"),l=(0,o.g2)("GrCard"),i=(0,o.g2)("GrButton"),u=(0,o.g2)("GrBubble"),d=(0,o.g2)("GrHighlight");return(0,o.uX)(),(0,o.CE)("div",Tt,[t[48]||(t[48]=(0,o.Lk)("h1",{class:"text-center mb-5"},"グラフィックレコーディング風UIコンポーネント",-1)),(0,o.Lk)("section",Ft,[t[5]||(t[5]=(0,o.Lk)("h2",{class:"section-title"},"タイトルコンポーネント (GrTitle)",-1)),(0,o.Lk)("div",qt,[(0,o.bF)(c,{tag:"h1",size:"xl",color:"primary"},{default:(0,o.k6)((()=>t[0]||(t[0]=[(0,o.eW)("プライマリーの特大タイトル")]))),_:1}),(0,o.bF)(c,{tag:"h2",size:"lg",color:"accent1"},{default:(0,o.k6)((()=>t[1]||(t[1]=[(0,o.eW)("アクセント1の大タイトル")]))),_:1}),(0,o.bF)(c,{tag:"h3",size:"md",color:"accent2"},{default:(0,o.k6)((()=>t[2]||(t[2]=[(0,o.eW)("アクセント2の中タイトル")]))),_:1}),(0,o.bF)(c,{tag:"h4",size:"sm",color:"accent3"},{default:(0,o.k6)((()=>t[3]||(t[3]=[(0,o.eW)("アクセント3の小タイトル")]))),_:1}),(0,o.bF)(c,{tag:"div",size:"sm",color:"accent4"},{default:(0,o.k6)((()=>t[4]||(t[4]=[(0,o.eW)("アクセント4のdivタイトル")]))),_:1})])]),(0,o.Lk)("section",Wt,[t[12]||(t[12]=(0,o.Lk)("h2",{class:"section-title"},"カードコンポーネント (GrCard)",-1)),(0,o.Lk)("div",It,[(0,o.bF)(l,{elevation:"sm",border:"primary"},{default:(0,o.k6)((()=>t[6]||(t[6]=[(0,o.Lk)("p",null,"プライマリーの枠線と小さい影のカード",-1)]))),_:1}),(0,o.bF)(l,{elevation:"md",border:"accent1"},{default:(0,o.k6)((()=>t[7]||(t[7]=[(0,o.Lk)("p",null,"アクセント1の枠線と中くらいの影のカード",-1)]))),_:1}),(0,o.bF)(l,{elevation:"lg",border:"accent2"},{default:(0,o.k6)((()=>t[8]||(t[8]=[(0,o.Lk)("p",null,"アクセント2の枠線と大きい影のカード",-1)]))),_:1}),(0,o.bF)(l,{elevation:"md",border:"accent3"},{default:(0,o.k6)((()=>t[9]||(t[9]=[(0,o.Lk)("p",null,"アクセント3の枠線と中くらいの影のカード",-1)]))),_:1}),(0,o.bF)(l,{elevation:"md",border:"accent4"},{default:(0,o.k6)((()=>t[10]||(t[10]=[(0,o.Lk)("p",null,"アクセント4の枠線と中くらいの影のカード",-1)]))),_:1}),(0,o.bF)(l,{elevation:"none",border:"none"},{default:(0,o.k6)((()=>t[11]||(t[11]=[(0,o.Lk)("p",null,"枠線なし、影なしのカード",-1)]))),_:1})])]),(0,o.Lk)("section",Mt,[t[23]||(t[23]=(0,o.Lk)("h2",{class:"section-title"},"ボタンコンポーネント (GrButton)",-1)),(0,o.Lk)("div",Dt,[(0,o.Lk)("div",Rt,[(0,o.bF)(i,{variant:"primary",size:"sm"},{default:(0,o.k6)((()=>t[13]||(t[13]=[(0,o.eW)("小さいボタン")]))),_:1}),(0,o.bF)(i,{variant:"primary",size:"md"},{default:(0,o.k6)((()=>t[14]||(t[14]=[(0,o.eW)("中くらいボタン")]))),_:1}),(0,o.bF)(i,{variant:"primary",size:"lg"},{default:(0,o.k6)((()=>t[15]||(t[15]=[(0,o.eW)("大きいボタン")]))),_:1})]),(0,o.Lk)("div",At,[(0,o.bF)(i,{variant:"primary"},{default:(0,o.k6)((()=>t[16]||(t[16]=[(0,o.eW)("プライマリー")]))),_:1}),(0,o.bF)(i,{variant:"accent1"},{default:(0,o.k6)((()=>t[17]||(t[17]=[(0,o.eW)("アクセント1")]))),_:1}),(0,o.bF)(i,{variant:"accent2"},{default:(0,o.k6)((()=>t[18]||(t[18]=[(0,o.eW)("アクセント2")]))),_:1}),(0,o.bF)(i,{variant:"accent3"},{default:(0,o.k6)((()=>t[19]||(t[19]=[(0,o.eW)("アクセント3")]))),_:1}),(0,o.bF)(i,{variant:"accent4"},{default:(0,o.k6)((()=>t[20]||(t[20]=[(0,o.eW)("アクセント4")]))),_:1})]),(0,o.Lk)("div",$t,[(0,o.bF)(i,{variant:"primary",disabled:""},{default:(0,o.k6)((()=>t[21]||(t[21]=[(0,o.eW)("無効ボタン")]))),_:1}),(0,o.bF)(i,{variant:"accent2",fullWidth:""},{default:(0,o.k6)((()=>t[22]||(t[22]=[(0,o.eW)("全幅ボタン")]))),_:1})])])]),(0,o.Lk)("section",Bt,[t[30]||(t[30]=(0,o.Lk)("h2",{class:"section-title"},"吹き出しコンポーネント (GrBubble)",-1)),(0,o.Lk)("div",Gt,[(0,o.Lk)("div",Ot,[(0,o.bF)(u,{direction:"bottom",color:"white"},{default:(0,o.k6)((()=>t[24]||(t[24]=[(0,o.Lk)("p",null,"下向き白吹き出し",-1)]))),_:1}),(0,o.bF)(u,{direction:"top",color:"accent1"},{default:(0,o.k6)((()=>t[25]||(t[25]=[(0,o.Lk)("p",null,"上向きアクセント1吹き出し",-1)]))),_:1})]),(0,o.Lk)("div",xt,[(0,o.bF)(u,{direction:"right",color:"accent2"},{default:(0,o.k6)((()=>t[26]||(t[26]=[(0,o.Lk)("p",null,"右向きアクセント2吹き出し",-1)]))),_:1}),(0,o.bF)(u,{direction:"left",color:"accent3"},{default:(0,o.k6)((()=>t[27]||(t[27]=[(0,o.Lk)("p",null,"左向きアクセント3吹き出し",-1)]))),_:1})]),(0,o.Lk)("div",zt,[(0,o.bF)(u,{direction:"bottom",color:"primary"},{default:(0,o.k6)((()=>t[28]||(t[28]=[(0,o.Lk)("p",null,"下向きプライマリー吹き出し",-1)]))),_:1}),(0,o.bF)(u,{direction:"bottom",color:"accent4"},{default:(0,o.k6)((()=>t[29]||(t[29]=[(0,o.Lk)("p",null,"下向きアクセント4吹き出し",-1)]))),_:1})])])]),(0,o.Lk)("section",Xt,[t[39]||(t[39]=(0,o.Lk)("h2",{class:"section-title"},"ハイライトコンポーネント (GrHighlight)",-1)),(0,o.Lk)("div",Pt,[(0,o.Lk)("p",null,[t[34]||(t[34]=(0,o.eW)(" これは")),(0,o.bF)(d,{color:"yellow"},{default:(0,o.k6)((()=>t[31]||(t[31]=[(0,o.eW)("黄色のハイライト")]))),_:1}),t[35]||(t[35]=(0,o.eW)("です。 これは")),(0,o.bF)(d,{color:"orange"},{default:(0,o.k6)((()=>t[32]||(t[32]=[(0,o.eW)("オレンジのハイライト")]))),_:1}),t[36]||(t[36]=(0,o.eW)("です。 これは")),(0,o.bF)(d,{color:"red"},{default:(0,o.k6)((()=>t[33]||(t[33]=[(0,o.eW)("赤のハイライト")]))),_:1}),t[37]||(t[37]=(0,o.eW)("です。 "))]),(0,o.Lk)("p",null,[(0,o.bF)(d,{color:"yellow",inline:!1},{default:(0,o.k6)((()=>t[38]||(t[38]=[(0,o.eW)(" インラインではないハイライトブロックです。これはより長いテキストに使用できます。 複数行にまたがる場合もあります。 ")]))),_:1})])])]),(0,o.Lk)("section",Ut,[t[47]||(t[47]=(0,o.Lk)("h2",{class:"section-title"},"組み合わせ例",-1)),(0,o.Lk)("div",Qt,[(0,o.bF)(l,{elevation:"md",border:"primary"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{tag:"h3",size:"md",color:"accent2"},{default:(0,o.k6)((()=>t[40]||(t[40]=[(0,o.eW)("猫先生からの挑戦状")]))),_:1}),(0,o.Lk)("p",null,[(0,o.bF)(d,{color:"yellow"},{default:(0,o.k6)((()=>t[41]||(t[41]=[(0,o.eW)("算数の問題")]))),_:1}),t[42]||(t[42]=(0,o.eW)("に挑戦してみましょう！ "))]),(0,o.Lk)("div",Kt,[(0,o.bF)(u,{direction:"left",color:"accent1"},{default:(0,o.k6)((()=>[(0,o.Lk)("p",null,[t[44]||(t[44]=(0,o.eW)("この問題、")),(0,o.bF)(d,{color:"red"},{default:(0,o.k6)((()=>t[43]||(t[43]=[(0,o.eW)("難しい")]))),_:1}),t[45]||(t[45]=(0,o.eW)("かもしれないニャ〜"))])])),_:1})]),(0,o.Lk)("div",Nt,[(0,o.bF)(i,{variant:"accent3",size:"lg"},{default:(0,o.k6)((()=>t[46]||(t[46]=[(0,o.eW)("挑戦する")]))),_:1})])])),_:1})])])])}var Jt={name:"ComponentPreview",components:{GrTitle:$,GrCard:re,GrButton:z,GrBubble:We,GrHighlight:Re}};const Ht=(0,k.A)(Jt,[["render",Vt],["__scopeId","data-v-430a4086"]]);var Yt=Ht;const Zt={class:"mistakes-view"},ea={class:"mistakes-header"},ta={key:0,class:"empty-state"},aa={class:"empty-image"},sa={class:"back-button"},oa={class:"subject-tabs"},ra=["onClick"],na={class:"tab-content"},ca={class:"count"},la=["title"],ia={key:0,class:"mistakes-content"},ua={class:"mistake-actions-area"},da={class:"mistake-cards"},pa={class:"mistake-header"},ka={class:"mistake-info"},ma={class:"mistake-count"},va={key:0,class:"frequent-badge",title:"よく間違える問題"},ga={class:"mistake-actions"},ba={class:"mistake-question"},ha={class:"mistake-explanation"},fa={key:0,class:"explanation-section"},Ca={key:1,class:"explanation-section"},ya={class:"explanation-debug"},_a={key:2,class:"explanation-section"},La={class:"explanation-text"},Sa={key:3,class:"explanation-section debug-section"},Ea={class:"explanation-debug"},ja={class:"back-button"},wa={key:2,class:"confirm-modal"},Ta={class:"modal-content"},Fa={class:"modal-actions"},qa={key:3,class:"confirm-modal"},Wa={class:"modal-content"},Ia={class:"modal-actions"};function Ma(e,t,a,s,r,n){const c=(0,o.g2)("GrTitle"),l=(0,o.g2)("CharacterDisplay"),i=(0,o.g2)("GrBubble"),u=(0,o.g2)("GrButton"),d=(0,o.g2)("GrHighlight"),p=(0,o.g2)("GrCard");return(0,o.uX)(),(0,o.CE)("div",Zt,[(0,o.Lk)("div",ea,[(0,o.bF)(c,{tag:"h1",size:"lg",color:"primary"},{default:(0,o.k6)((()=>t[5]||(t[5]=[(0,o.eW)("間違えた問題")]))),_:1})]),0===s.totalMistakes?((0,o.uX)(),(0,o.CE)("div",ta,[(0,o.Lk)("div",aa,[(0,o.bF)(l,{image:"sleepy_cat.webp",size:"large"})]),(0,o.bF)(i,null,{default:(0,o.k6)((()=>t[6]||(t[6]=[(0,o.Lk)("p",null,"まだ間違えた問題はありません。",-1),(0,o.Lk)("p",null,"クイズに挑戦して、苦手な問題を見つけましょう！",-1)]))),_:1}),(0,o.Lk)("div",sa,[(0,o.bF)(u,{variant:"primary",onClick:s.goToHome},{default:(0,o.k6)((()=>t[7]||(t[7]=[(0,o.eW)("ホームに戻る")]))),_:1},8,["onClick"])])])):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.Lk)("div",oa,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.availableSubjects,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.code,class:(0,b.C4)(["subject-tab",{active:s.selectedSubject===e.code}]),onClick:t=>s.selectSubject(e.code)},[(0,o.Lk)("div",na,[(0,o.Lk)("span",null,(0,b.v_)(e.name),1),(0,o.Lk)("span",ca,(0,b.v_)(s.mistakesBySubject[e.code]||0),1),s.frequentMistakesBySubject[e.code]?((0,o.uX)(),(0,o.CE)("span",{key:0,class:"frequent-marker",title:`よく間違える問題が${s.frequentMistakesBySubject[e.code]}個あります`},"★",8,la)):(0,o.Q3)("",!0)])],10,ra)))),128))]),s.selectedSubject&&s.filteredMistakes.length>0?((0,o.uX)(),(0,o.CE)("div",ia,[(0,o.Lk)("div",ua,[(0,o.bF)(u,{variant:"primary",onClick:t[0]||(t[0]=e=>s.retryAllMistakes(!1))},{default:(0,o.k6)((()=>t[8]||(t[8]=[(0,o.eW)(" すべての問題に挑戦 ")]))),_:1}),s.hasFrequentMistakes?((0,o.uX)(),(0,o.Wv)(u,{key:0,variant:"accent4",onClick:t[1]||(t[1]=e=>s.retryAllMistakes(!0))},{default:(0,o.k6)((()=>t[9]||(t[9]=[(0,o.eW)(" よく間違える問題に挑戦 ")]))),_:1})):(0,o.Q3)("",!0),s.hasClearableMistakes?((0,o.uX)(),(0,o.Wv)(u,{key:1,variant:"warning",onClick:t[2]||(t[2]=e=>s.showClearAllConfirmation=!0)},{default:(0,o.k6)((()=>t[10]||(t[10]=[(0,o.eW)(" すべてクリア ")]))),_:1})):(0,o.Q3)("",!0)]),(0,o.Lk)("div",da,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.filteredMistakes,(e=>((0,o.uX)(),(0,o.Wv)(p,{key:e.questionId,class:(0,b.C4)({"frequent-mistake":e.count>=2})},{default:(0,o.k6)((()=>[(0,o.Lk)("div",pa,[(0,o.Lk)("div",ka,[(0,o.Lk)("span",ma,(0,b.v_)(e.count)+"回間違えました",1),e.count>=2?((0,o.uX)(),(0,o.CE)("span",va,"★ よく間違える問題")):(0,o.Q3)("",!0)]),(0,o.Lk)("div",ga,[(0,o.bF)(u,{variant:"primary",size:"sm",class:"retry-button",onClick:t=>s.retryQuestion(e)},{default:(0,o.k6)((()=>t[11]||(t[11]=[(0,o.eW)(" 再挑戦 ")]))),_:2},1032,["onClick"]),(0,o.bF)(u,{variant:"warning",size:"sm",onClick:t=>s.confirmClearMistake(e.questionId)},{default:(0,o.k6)((()=>t[12]||(t[12]=[(0,o.eW)(" クリア ")]))),_:2},1032,["onClick"])])]),(0,o.Lk)("div",ba,[(0,o.bF)(d,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,b.v_)(e.question),1)])),_:2},1024)]),(0,o.Lk)("div",ha,[s.isExplanationLoading(e)?((0,o.uX)(),(0,o.CE)("div",fa,t[13]||(t[13]=[(0,o.Lk)("h4",{class:"explanation-title"},"解説を読み込み中...",-1),(0,o.Lk)("p",{class:"explanation-loading"},"お待ちください",-1)]))):s.isExplanationLoading(e)||null!==s.getExplanation(e)?s.getExplanation(e)?((0,o.uX)(),(0,o.CE)("div",_a,[t[15]||(t[15]=(0,o.Lk)("h4",{class:"explanation-title"},"解説",-1)),(0,o.Lk)("p",La,(0,b.v_)(s.getExplanation(e)),1)])):((0,o.uX)(),(0,o.CE)("div",Sa,[t[16]||(t[16]=(0,o.Lk)("h4",{class:"explanation-title"},"解説が見つかりません",-1)),(0,o.Lk)("p",Ea," 利用可能なデータキー: "+(0,b.v_)(Object.keys(e).join(", ")),1)])):((0,o.uX)(),(0,o.CE)("div",Ca,[t[14]||(t[14]=(0,o.Lk)("h4",{class:"explanation-title"},"解説が見つかりません",-1)),(0,o.Lk)("p",ya,"利用可能なデータキー: "+(0,b.v_)(Object.keys(e).join(", ")),1)]))])])),_:2},1032,["class"])))),128))])])):(0,o.Q3)("",!0),(0,o.Lk)("div",ja,[(0,o.bF)(u,{variant:"primary",onClick:s.goToHome},{default:(0,o.k6)((()=>t[17]||(t[17]=[(0,o.eW)("ホームに戻る")]))),_:1},8,["onClick"])])],64)),s.showClearConfirmation?((0,o.uX)(),(0,o.CE)("div",wa,[(0,o.Lk)("div",Ta,[t[20]||(t[20]=(0,o.Lk)("h2",null,"確認",-1)),t[21]||(t[21]=(0,o.Lk)("p",null,"この問題をクリアしますか？",-1)),t[22]||(t[22]=(0,o.Lk)("p",{class:"warning-text"},"※クリアした問題は元に戻せません",-1)),(0,o.Lk)("div",Fa,[(0,o.bF)(u,{variant:"secondary",onClick:t[3]||(t[3]=e=>s.showClearConfirmation=!1)},{default:(0,o.k6)((()=>t[18]||(t[18]=[(0,o.eW)(" キャンセル ")]))),_:1}),(0,o.bF)(u,{variant:"warning",onClick:s.clearMistake},{default:(0,o.k6)((()=>t[19]||(t[19]=[(0,o.eW)(" クリアする ")]))),_:1},8,["onClick"])])])])):(0,o.Q3)("",!0),s.showClearAllConfirmation?((0,o.uX)(),(0,o.CE)("div",qa,[(0,o.Lk)("div",Wa,[t[25]||(t[25]=(0,o.Lk)("h2",null,"確認",-1)),t[26]||(t[26]=(0,o.Lk)("p",null,"クリア可能なすべての問題をクリアしますか？",-1)),t[27]||(t[27]=(0,o.Lk)("p",{class:"warning-text"},"※クリアした問題は元に戻せません",-1)),(0,o.Lk)("div",Ia,[(0,o.bF)(u,{variant:"secondary",onClick:t[4]||(t[4]=e=>s.showClearAllConfirmation=!1)},{default:(0,o.k6)((()=>t[23]||(t[23]=[(0,o.eW)(" キャンセル ")]))),_:1}),(0,o.bF)(u,{variant:"warning",onClick:s.clearAllMistakes},{default:(0,o.k6)((()=>t[24]||(t[24]=[(0,o.eW)(" すべてクリアする ")]))),_:1},8,["onClick"])])])])):(0,o.Q3)("",!0)])}a(2489),a(1701),a(3579),a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698);class Da{constructor(){this.cache={index:null,problemFiles:{},topicProblems:{},questionById:{}},this.version="1.1.0",this.checkCacheVersion()}checkCacheVersion(){const e=localStorage.getItem("dataManagerVersion");e!==this.version&&(console.log(`キャッシュバージョンが異なるためクリアします (${e} → ${this.version})`),this.clearCache(),localStorage.setItem("dataManagerVersion",this.version))}clearCache(e=!0){e?(this.cache={index:null,problemFiles:{},topicProblems:{},questionById:{}},localStorage.removeItem("subjectsData"),localStorage.removeItem("dataManagerVersion"),this.timestamp=(new Date).getTime(),console.log("キャッシュデータを完全にクリアしました")):(this.cache.problemFiles={},this.cache.topicProblems={},this.cache.questionById={},console.log("問題データのキャッシュをクリアしました"))}async loadIndex(){if(this.cache.index)return this.cache.index;try{const e="/cat-teacher-quiz";this.timestamp||(this.timestamp=(new Date).getTime());const t=await fetch(`${e}/data/subjects.json?v=${this.timestamp}`);if(!t.ok)throw new Error(`インデックスデータの読み込みに失敗しました: ${t.status}`);const a=await t.json();return this.cache.index=a,localStorage.setItem("subjectsData",JSON.stringify(a)),a}catch(e){throw console.error("インデックスデータの読み込み中にエラーが発生しました:",e),e}}async getSubjects(){const e=await this.loadIndex();return e.subjects}async getTopics(e){const t=await this.loadIndex(),a=t.subjects.find((t=>t.code===e));if(!a)throw new Error(`指定された科目コード「${e}」は存在しません。`);return a.topics}async getDataFiles(e,t){const a=await this.loadIndex(),s=a.subjects.find((t=>t.code===e));if(!s)throw new Error(`指定された科目コード「${e}」は存在しません。`);const o=s.topics.find((e=>e.code===t));if(!o)throw new Error(`指定されたトピックコード「${t}」は存在しません。`);if(o.dataFiles)return o.dataFiles;if(o.dataFile)return[o.dataFile];throw new Error(`トピック「${t}」にデータファイルが指定されていません。`)}async loadProblemFile(e){if(this.cache.problemFiles[e])return this.cache.problemFiles[e];try{const t="/cat-teacher-quiz",a=(new Date).getTime(),s=await fetch(`${t}/data/${e}?v=${a}`);if(!s.ok)throw new Error(`問題ファイル「${e}」の読み込みに失敗しました: ${s.status}`);const o=await s.json();if(!o.questions||!Array.isArray(o.questions))throw new Error(`問題ファイル「${e}」の形式が不正です。questions配列が見つかりません。`);return this.cache.problemFiles[e]=o,o.questions.forEach((e=>{e.id&&(this.cache.questionById[e.id]=e)})),o}catch(t){throw console.error(`問題ファイル「${e}」の読み込み中にエラーが発生しました:`,t),t}}async loadTopicProblems(e,t){const a=`${e}_${t}`;if(this.cache.topicProblems[a])return console.log(`キャッシュから問題データを取得: ${e}_${t}、問題数: ${this.cache.topicProblems[a].questions.length}`),this.cache.topicProblems[a];try{const s=await this.getDataFiles(e,t);console.log(`読み込むファイル一覧: ${JSON.stringify(s)}`);const o=[],r={subject:e,topic:t};for(const e of s){console.log(`ファイル読み込み開始: ${e}`);const t=await this.loadProblemFile(e);console.log(`ファイル読み込み完了: ${e}、問題数: ${t.questions.length}`),o.push(...t.questions),t.metadata&&Object.assign(r,t.metadata)}console.log(`全ファイル読み込み完了、合計問題数: ${o.length}`);const n={subject:e,topic:t,metadata:r,questions:o};return this.cache.topicProblems[a]=n,n}catch(s){throw console.error(`トピック「${e}_${t}」の問題データ読み込み中にエラーが発生しました:`,s),s}}async getProblems(e,t){const a=await this.loadTopicProblems(e,t);return a.questions}async getProblemsByFileNumber(e,t){const a=`${e}${t}.json`;try{const e=await this.loadProblemFile(a);return e.questions}catch(s){throw console.error(`ファイル番号「${t}」の問題データ取得中にエラーが発生しました:`,s),s}}async getQuestionById(e){if(this.cache.questionById[e])return this.cache.questionById[e];throw new Error(`問題ID「${e}」が見つかりません。先に関連するトピックの問題を読み込んでください。`)}async getMetadata(e,t){const a=await this.loadTopicProblems(e,t);return{subject:a.subject,topic:a.topic,metadata:a.metadata}}}var Ra=Da,Aa={name:"MistakesView",components:{GrTitle:$,GrButton:z,GrCard:re,GrHighlight:Re,GrBubble:We,CharacterDisplay:dt},setup(){const e=(0,d.Pj)(),t=(0,g.rd)(),a=(0,M.KR)(null),s=(0,M.KR)(!1),r=(0,M.KR)(!1),n=(0,M.KR)(null),c=[{code:"science",name:"理科"},{code:"social",name:"社会"}],l=()=>{if(!a.value&&Object.keys(u.value).length>0){const e=Object.keys(u.value);a.value=e[0]}},i=(0,o.EW)((()=>e.getters["mistakes/totalMistakes"])),u=(0,o.EW)((()=>e.getters["mistakes/mistakesBySubject"])),p=(0,o.EW)((()=>e.getters["mistakes/frequentMistakesBySubject"])),k=(0,o.EW)((()=>m.value.some((e=>e.count>=2)))),m=(0,o.EW)((()=>{if(!a.value)return[];const t=e.getters["mistakes/mistakesListBySubject"](a.value);return console.log("間違い一覧データ:",t),t.length>0&&console.log("最初の間違いデータサンプル:",{"問題ID":t[0].questionId,"問題文":t[0].question,"正解選択肢":t[0].correctAnswer,"解説":t[0].explanation,"データキー":Object.keys(t[0])}),t})),v=(0,o.EW)((()=>m.value.some((e=>e.isClearable)))),b=t=>e.getters["mistakes/getLockedMessage"](t),h=e=>{a.value=e},f=e=>{n.value=e,s.value=!0},C=()=>{n.value&&(e.dispatch("mistakes/clearMistake",n.value),s.value=!1,n.value=null,0===i.value?a.value=null:l())},y=()=>{e.dispatch("mistakes/clearAllMistakes"),r.value=!1,0===i.value?a.value=null:l()},_=()=>{t.push({name:"home"})},L=e=>{const a=e.questionId,s=e.subject,o=e.topic;if(console.log("再挑戦する問題の情報:",{"問題ID":a,"科目コード":s,"トピックコード":o}),!s||!o)return void console.error("科目コードまたはトピックコードが見つかりません",e);const r={mode:"retry",questionId:a};t.push({name:"quiz",params:{subjectCode:s,topicCode:o},query:r})},S=(e=!1)=>{if(!a.value||0===m.value.length)return;let s=[...m.value];if(e&&(s=s.filter((e=>e.count>=2))),0===s.length)return void console.warn("対象となる問題がありません");const o=s.map((e=>e.questionId)),r=a.value,n=[...new Set(s.map((e=>e.topic)))],c=1===n.length?n[0]:s[0].topic;if(n.length>1&&console.log("複数のトピックにまたがる問題があります:",n),console.log("再挑戦パラメータ確認:",{"科目コード":r,"トピックコード":c,"問題数":o.length,"対象トピック数":n.length,"よく間違えるモード":e}),!r||!c)return void console.error("科目またはトピックが正しく取得できませんでした");const l={mode:"retryMultiple",questionIds:JSON.stringify(o),frequentOnly:e?"true":"false"};try{t.push({name:"quiz",params:{subjectCode:r,topicCode:c},query:l}),console.log("クイズに遷移します:",{"科目":r,"トピック":c,"問題数":o.length,"モード":e?"よく間違える問題":"すべての間違えた問題"})}catch(i){console.error("クイズページへの遷移中にエラーが発生しました:",i)}};(0,o.sV)((()=>{e.commit("mistakes/updateClearableStatus"),l(),m.value.forEach((e=>{F(e)}))}));const E=new Ra,j=(0,M.KR)({}),w=(0,M.KR)({}),T=e=>e&&e.questionId&&!0===w.value[e.questionId],F=async e=>{const t=e.questionId;if(void 0===j.value[t]&&!w.value[t]){w.value[t]=!0;try{if(e.explanation)return void(j.value[t]=e.explanation);if(e.subject&&e.topic&&e.questionId)try{const a=`${e.subject}_${e.topic}.json`,s=await E.loadProblemFile(a);if(s&&s.questions){const a=s.questions.find((t=>t.id===e.questionId));if(a&&a.explanation)return void(j.value[t]=a.explanation)}}catch(a){console.error("データ取得エラー:",a)}j.value[t]=null}finally{w.value[t]=!1}}},q=e=>{const t=e.questionId;return void 0===j.value[t]?(F(e),null):j.value[t]};return{selectedSubject:a,availableSubjects:c,isExplanationLoading:T,totalMistakes:i,mistakesBySubject:u,frequentMistakesBySubject:p,filteredMistakes:m,hasClearableMistakes:v,showClearConfirmation:s,showClearAllConfirmation:r,getLockedMessage:b,selectSubject:h,confirmClearMistake:f,clearMistake:C,clearAllMistakes:y,goToHome:_,retryQuestion:L,retryAllMistakes:S,hasFrequentMistakes:k,getExplanation:q,explanations:j}}};const $a=(0,k.A)(Aa,[["render",Ma],["__scopeId","data-v-72c7fca2"]]);var Ba=$a;const Ga=[{path:"/",name:"home",component:U,meta:{transition:"fade"}},{path:"/mistakes",name:"mistakes",component:Ba,meta:{transition:"fade"}},{path:"/subjects",name:"subjects",component:ue,meta:{transition:"slide-left"}},{path:"/subjects/:subjectCode/topics",name:"topics",component:Be,props:!0,meta:{transition:"slide-left"}},{path:"/subjects/:subjectCode/topics/:topicCode/quiz",name:"quiz",component:mt,props:!0,meta:{transition:"slide-left"}},{path:"/subjects/:subjectCode/topics/:topicCode/result",name:"result",component:wt,props:!0,meta:{transition:"slide-left"}},{path:"/components",name:"components",component:Yt,meta:{transition:"fade"}}],Oa=(0,g.aE)({history:(0,g.LA)("/cat-teacher-quiz/"),routes:Ga});var xa=Oa;const za=()=>{const e=new Date,t=new Date(e),a=e.getDay(),s=0===a?7:7-a;return t.setDate(e.getDate()+s),t.setHours(18,0,0,0),t},Xa=e=>{const t=new Date,a=e-t;if(a<=0)return"クリア可能です";const s=Math.floor(a/864e5),o=Math.floor(a%864e5/36e5),r=Math.floor(a%36e5/6e4);let n="";return s>0&&(n+=`${s}日 `),n+=`${o}時間 ${r}分`,n},Pa={mistakesList:[],lastUpdated:null},Ua={addMistake(e,{questionId:t,subject:a,topic:s,question:o,options:r,correctAnswer:n,explanation:c}){const l=e.mistakesList.findIndex((e=>e.questionId===t));if(l>=0){const t=e.mistakesList[l];e.mistakesList[l]={...t,count:t.count+1,lastMistaken:(new Date).toISOString(),clearableAt:za().toISOString()}}else e.mistakesList.push({questionId:t,subject:a,topic:s,question:o,options:r,correctAnswer:n,explanation:c,count:1,lastMistaken:(new Date).toISOString(),clearableAt:za().toISOString(),isClearable:!1});e.lastUpdated=(new Date).toISOString()},clearMistake(e,t){const a=e.mistakesList.findIndex((e=>e.questionId===t&&e.isClearable));a>=0&&(e.mistakesList.splice(a,1),e.lastUpdated=(new Date).toISOString())},clearAllMistakes(e){e.mistakesList=e.mistakesList.filter((e=>!e.isClearable)),e.lastUpdated=(new Date).toISOString()},markCorrect(e,t){const a=e.mistakesList.findIndex((e=>e.questionId===t));if(a>=0){const t=e.mistakesList[a];t.count>1?e.mistakesList[a]={...t,count:t.count-1,lastMistaken:(new Date).toISOString()}:e.mistakesList.splice(a,1),e.lastUpdated=(new Date).toISOString()}},updateClearableStatus(e){const t=new Date;e.mistakesList.forEach(((a,s)=>{const o=new Date(a.clearableAt);e.mistakesList[s].isClearable=t>=o}))},setState(e,{mistakesList:t,lastUpdated:a}){e.mistakesList=t||[],e.lastUpdated=a||null}},Qa={recordMistake({commit:e,dispatch:t},a){e("addMistake",a),t("saveToLocalStorage")},clearMistake({commit:e,dispatch:t},a){e("clearMistake",a),t("saveToLocalStorage")},clearAllMistakes({commit:e,dispatch:t}){e("clearAllMistakes"),t("saveToLocalStorage")},markCorrect({commit:e,dispatch:t},a){e("markCorrect",a),t("saveToLocalStorage")},loadFromLocalStorage({commit:e}){try{const t=localStorage.getItem("cat-teacher-mistakes");if(t){const a=JSON.parse(t);e("setState",a),e("updateClearableStatus")}}catch(t){console.error("間違えた問題データの読み込みに失敗しました",t)}},saveToLocalStorage({state:e}){try{const t={mistakesList:e.mistakesList,lastUpdated:e.lastUpdated};localStorage.setItem("cat-teacher-mistakes",JSON.stringify(t))}catch(t){console.error("間違えた問題データの保存に失敗しました",t)}}},Ka={totalMistakes:e=>e.mistakesList.length,mistakesBySubject:e=>{const t={};return e.mistakesList.forEach((e=>{t[e.subject]||(t[e.subject]=0),t[e.subject]++})),t},frequentMistakesBySubject:e=>{const t={};return e.mistakesList.forEach((e=>{e.count>=2&&(t[e.subject]||(t[e.subject]=0),t[e.subject]++)})),t},mistakesListBySubject:e=>t=>e.mistakesList.filter((e=>e.subject===t)).sort(((e,t)=>t.count-e.count)),mistakesListBySubjectAndTopic:e=>(t,a)=>e.mistakesList.filter((e=>e.subject===t&&e.topic===a)).sort(((e,t)=>t.count-e.count)),frequentMistakesList:e=>e.mistakesList.filter((e=>e.count>=2)).sort(((e,t)=>t.count-e.count)),getLockedMessage:()=>e=>{if(e.isClearable)return"クリア可能です";const t=new Date(e.clearableAt);return`次の日曜18時(${t.toLocaleDateString()})までクリアできません。残り時間: ${Xa(t)}`}};var Na={namespaced:!0,state:Pa,mutations:Ua,actions:Qa,getters:Ka};const Va=new Ra;var Ja=(0,d.y$)({modules:{mistakes:Na},state:{subjects:[],currentSubject:null,currentTopic:null,problems:[],metadata:null,loading:!1,error:null,userData:{currentRank:"ビギナー",score:0,completedTopics:{},lastPlayed:null}},getters:{getSubjects:e=>e.subjects,getCurrentSubject:e=>e.currentSubject,getCurrentTopic:e=>e.currentTopic,getProblems:e=>e.problems,getMetadata:e=>e.metadata,isLoading:e=>e.loading,getError:e=>e.error,getUserData:e=>e.userData},mutations:{SET_SUBJECTS(e,t){e.subjects=t},SET_CURRENT_SUBJECT(e,t){e.currentSubject=t},SET_CURRENT_TOPIC(e,t){e.currentTopic=t},SET_PROBLEMS(e,t){e.problems=t},SET_METADATA(e,t){e.metadata=t},SET_LOADING(e,t){e.loading=t},SET_ERROR(e,t){e.error=t},SET_USER_DATA(e,t){e.userData=t},UPDATE_TOPIC_COMPLETION(e,{subjectCode:t,topicCode:a,completed:s,score:o}){e.userData.completedTopics[t]||(e.userData.completedTopics[t]={}),e.userData.completedTopics[t][a]={completed:s,score:o,completedAt:(new Date).toISOString()},e.userData.lastPlayed=(new Date).toISOString()},UPDATE_USER_RANK(e,t){e.userData.currentRank=t},UPDATE_USER_SCORE(e,t){e.userData.score=t}},actions:{async loadSubjectsData({commit:e},t={}){e("SET_LOADING",!0),e("SET_ERROR",null);try{t.forceRefresh&&(Va.clearCache(),console.log("データマネージャーのキャッシュをクリアしました"));const a=await Va.loadIndex();e("SET_SUBJECTS",a.subjects),console.log("科目データを読み込みました:",a.subjects)}catch(a){e("SET_ERROR",a.message),console.error("科目データの読み込み中にエラーが発生しました:",a)}finally{e("SET_LOADING",!1)}},async loadProblems({commit:e,dispatch:t},{subjectCode:a,topicCode:s,forceRefresh:o=!1}){e("SET_LOADING",!0),e("SET_ERROR",null);try{o&&(Va.clearCache(),await t("loadSubjectsData",{forceRefresh:!0}),console.log("科目データを強制再読み込みしました"));const r=await Va.getSubjects();console.log("利用可能な科目:",r.map((e=>e.code)));const n=r.find((e=>e.code===a));if(!n)throw new Error(`指定された科目コード「${a}」は存在しません。`);console.log(`科目 "${n.name}" のトピック一覧:`,n.topics.map((e=>({code:e.code,name:e.name,icon:e.icon,dataFiles:e.dataFiles}))));const c=await Va.getTopics(a),l=c.find((e=>e.code===s));if(!l)throw new Error(`指定された科目「${a}」にトピック「${s}」は存在しません。`);console.log(`選択されたトピック: ${l.name} (${s}), データファイル:`,l.dataFiles),e("SET_CURRENT_SUBJECT",n),e("SET_CURRENT_TOPIC",l);const i=await Va.getProblems(a,s);console.log(`トピック "${l.name}" のロードされた問題数:`,i.length),i&&Array.isArray(i)?i.length>0?(e("SET_PROBLEMS",i),console.log(`問題データをセットしました: ${i.length}個の問題`)):(console.error("問題データが空です"),e("SET_PROBLEMS",[])):(console.error("問題データの形式が不正です:",i),e("SET_PROBLEMS",[]));const u=await Va.getMetadata(a,s);u&&(e("SET_METADATA",u),console.log("メタデータをセットしました:",u))}catch(r){e("SET_ERROR",r.message),console.error("問題データの読み込み中にエラーが発生しました:",r)}finally{e("SET_LOADING",!1)}},loadUserData({commit:e}){try{const t=localStorage.getItem("catTeacherUserData");t&&e("SET_USER_DATA",JSON.parse(t))}catch(t){console.error("ユーザーデータの読み込み中にエラーが発生しました:",t)}},saveUserData({state:e}){try{localStorage.setItem("catTeacherUserData",JSON.stringify(e.userData))}catch(t){console.error("ユーザーデータの保存中にエラーが発生しました:",t)}},updateTopicCompletion({commit:e,dispatch:t},{subjectCode:a,topicCode:s,completed:o,score:r}){e("UPDATE_TOPIC_COMPLETION",{subjectCode:a,topicCode:s,completed:o,score:r}),t("saveUserData")},updateUserRank({commit:e,dispatch:t},a){e("UPDATE_USER_RANK",a),t("saveUserData")},updateUserScore({commit:e,dispatch:t},a){e("UPDATE_USER_SCORE",a),t("saveUserData")}}});const Ha=(0,s.Ef)(v);Ha.use(xa),Ha.use(Ja),Ha.mount("#app")}},t={};function a(s){var o=t[s];if(void 0!==o)return o.exports;var r=t[s]={exports:{}};return e[s].call(r.exports,r,r.exports,a),r.exports}a.m=e,function(){var e=[];a.O=function(t,s,o,r){if(!s){var n=1/0;for(u=0;u<e.length;u++){s=e[u][0],o=e[u][1],r=e[u][2];for(var c=!0,l=0;l<s.length;l++)(!1&r||n>=r)&&Object.keys(a.O).every((function(e){return a.O[e](s[l])}))?s.splice(l--,1):(c=!1,r<n&&(n=r));if(c){e.splice(u--,1);var i=o();void 0!==i&&(t=i)}}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[s,o,r]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,s){var o,r,n=s[0],c=s[1],l=s[2],i=0;if(n.some((function(t){return 0!==e[t]}))){for(o in c)a.o(c,o)&&(a.m[o]=c[o]);if(l)var u=l(a)}for(t&&t(s);i<n.length;i++)r=n[i],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(u)},s=self["webpackChunkcat_teacher_quiz"]=self["webpackChunkcat_teacher_quiz"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[504],(function(){return a(7883)}));s=a.O(s)})();
//# sourceMappingURL=app.b0e82f5d.js.map